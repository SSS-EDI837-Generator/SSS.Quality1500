<UserControl x:Class="SSS.Quality1500.Presentation.Views.Icd10UserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:vm="clr-namespace:SSS.Quality1500.Presentation.ViewModels"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=vm:Icd10ViewModel, IsDesignTimeCreatable=False}"
             d:DesignHeight="700" d:DesignWidth="900">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    </UserControl.Resources>

    <materialDesign:DialogHost IsOpen="{Binding IsConfirmDialogOpen}">
        <materialDesign:DialogHost.DialogContent>
            <StackPanel Margin="24" MinWidth="300">
                <TextBlock Text="Confirmar eliminacion"
                           Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                           FontWeight="Bold"
                           Margin="0,0,0,16" />
                <TextBlock Margin="0,0,0,24">
                    <Run Text="Desea eliminar el codigo " />
                    <Run Text="{Binding CodeToRemove, Mode=OneWay}" FontWeight="Bold" />
                    <Run Text="?" />
                </TextBlock>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="No"
                            Command="{Binding CancelRemoveCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Margin="0,0,8,0" />
                    <Button Content="Si"
                            Command="{Binding ConfirmRemoveCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}" />
                </StackPanel>
            </StackPanel>
        </materialDesign:DialogHost.DialogContent>

        <Grid>
        <!-- Main content -->
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,16">
                <TextBlock Text="Gestion de Codigos ICD-10"
                           Style="{StaticResource MaterialDesignHeadline5TextBlock}" />
                <TextBlock Margin="0,4,0,0">
                    <Run Text="Total en catalogo: " />
                    <Run Text="{Binding TotalCodes, Mode=OneWay}" FontWeight="Bold" />
                    <Run Text=" | Mostrando: " />
                    <Run Text="{Binding DisplayedCount, Mode=OneWay}" FontWeight="Bold" />
                </TextBlock>
            </StackPanel>

            <!-- Search Bar -->
            <materialDesign:Card Grid.Row="1" Margin="0,0,0,12" Padding="12">
                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         materialDesign:HintAssist.Hint="Buscar por codigo o descripcion..."
                         materialDesign:TextFieldAssist.HasClearButton="True"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}" />
            </materialDesign:Card>

            <!-- Loading indicator -->
            <ProgressBar Grid.Row="2"
                         VerticalAlignment="Top"
                         IsIndeterminate="True"
                         Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}" />

            <!-- DataGrid -->
            <DataGrid Grid.Row="2"
                      Margin="0,8,0,0"
                      ItemsSource="{Binding Codes}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      HeadersVisibility="Column"
                      GridLinesVisibility="Horizontal"
                      VerticalScrollBarVisibility="Auto">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Codigo"
                                        Binding="{Binding Code}"
                                        Width="120" />
                    <DataGridTextColumn Header="Descripcion"
                                        Binding="{Binding Description}"
                                        Width="*" />
                    <DataGridTemplateColumn Header="" Width="Auto">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Eliminar"
                                        Command="{Binding DataContext.RequestRemoveCodeCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding Code}"
                                        Style="{StaticResource MaterialDesignFlatButton}"
                                        Foreground="Red"
                                        Padding="8,2" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- Separator -->
            <Separator Grid.Row="3" Margin="0,12" />

            <!-- Add new code form -->
            <materialDesign:Card Grid.Row="4" Padding="16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Text="{Binding NewCode, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Codigo (ej: T86.11)"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,8,0"
                             CharacterCasing="Upper" />

                    <TextBox Grid.Column="1"
                             Text="{Binding NewDescription, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Descripcion"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Margin="0,0,8,0" />

                    <Button Grid.Column="2"
                            Content="Agregar"
                            Command="{Binding AddCodeCommand}"
                            Style="{StaticResource MaterialDesignRaisedButton}" />
                </Grid>
            </materialDesign:Card>
        </Grid>

        <!-- Snackbar overlay at bottom of entire view -->
        <materialDesign:Snackbar MessageQueue="{Binding MessageQueue}"
                                  VerticalAlignment="Bottom"
                                  HorizontalAlignment="Center" />
    </Grid>
    </materialDesign:DialogHost>
</UserControl>
